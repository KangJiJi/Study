06 객체 지도
================

*유일하게 변하지 않는 것은 모든 것이 변한다는 사실뿐이다.*<br>

-헤라클레이토스(Heraclitus of Ephesus)

&nbsp;여행 중 길을 모르는 경우 해결방법은 두가지 방법이 있을 것이다.

* 타인에게 직접 길을 물어보는 방법
* 지도를 보는 방법

전자의 방법은 '기능적이고 해결책 지향적인 접근법(Functional, Solution-directed approach)'이다. 이 방법은 일반적이지도, 재사용 가능하지도 않다.

하지만 후자의 방법은 실세계를 추상화한 지도를 가지고 길을 찾을 수 있다. 이러한 방법은 '구조적이고 문제 지향적인 접근법(Structural, Problem-directed approach)'이다. 전자의 방법과 다르게 길을 찾을 수 있는 '구조'를 제공한다. 또한 재사용 가능하다.

지도 은유의 핵심은 구조를 기반으로 모델을 만드는 것이 범용적이고 이해하기 쉽고 변경에 안정적이라는 것이다. 하지만 기능을 중심으로 구조를 종속시키는 접근은 범용적이지도 않으면서 재사용이 불가능하며 변경에 취약하다. 따라서 구조를 바탕으로 시스템을 분할해 책임-주도 설계를 할 수 있어야 한다.

## 기능 설계 대 구조 설계
&nbsp;소프트웨어 설계 측면에는 '기능(Function)'측면의 설계와 '구조(structure)'측면의 설계가 있다. 기능 측면 설계는 무엇을 할 수 있는지에 초점이 있고, 구조 측면 설계는 형태가 어떠해야 하는지에 초점이 있다. 이 두가지 측면은 서로 조화를 이루어야 가장 좋은 설계라고 할 수 있다.

소프트웨어는 사용자에게 충분히 매력적이여야 하면서 유지보수와 확장을 쉽게 할 수 있어야 한다. 훌륭한 설계는 만족스러운 기능을 포함해 요구사항 변경에 유연하게 대처할 수 있는 구조를 가지고 있어야 한다. 하지만 우리는 미래를 예측할 수 없다. 따라서 변경을 예측하는 것이 아닌 변경을 수용할 수 있는 선택의 여지를 설계에 마련해야 한다.

객체지향 접근방법은 안정적인 객체 구조를 바탕으로 책임을 분배한다. 이는 더 작은 책임으로 분할되고 적절한 객체에 분배되기 때문에 기능이 변경되더라도 구조는 유지된다.

## 두 가지 재료: 기능과 구조
&nbsp;설계를 위해서는 사용자에게 제공할 '기능'과 기능을 담을 '구조'가 필요하다. 또한 구조는 기능 변경을 수용할 수 있도록 안정적이어야 한다. 다음은 기능과 구조를 표현할 수 있는 두 가지 기법이다.

* 구조는 사용자나 이해관계자들이 도메인(domain)에 관해 생각하는 개념과 개념들 간의 관계로 표현한다.
* 기능은 사용자의 목표를 만족시키기 위해 책임을 수행하는 시스템의 행위로 표현한다.

일반적으로 전자의 기법을 '도메인 모델링'이라하고, 후자의 기법을 '유스케이스 모델링'이라고 한다.

## 안정적인 재료: 구조

### 도메인 모델
&nbsp;사용자가 프로그램을 사용하는 대상 분야를 '도메인'이라고 한다. 병원, 은행, 게임 등등 각자의 사용자의 필요성을 충족시킬 수 있는 분야가 도메인이다. 또한 중요한 문제에 집중할 수 있도록 필요한 지식만을 추상화하고 단순화한 것을 '모델'이라고 한다.

따라서 '도메인 모델'이란 프로그램이 사용되는 영역에 관한 지식을 단순화하고 구조화한 형태다. 또한 도메인 모델은 멘탈 모델(Mental Model)이다. 멘탈 모델이란 자신이 상호작용하는 사물들에 대해 갖는 모형이다.

완벽한 설계는 사용자들의 멘탈 모델과 일치해야 한다. 그래야 사용자가 예상하는 방식에 따라 정확하게 반응할 수 있기 때문이다. 도널드 노먼(Donald Norman)은 멘탈 모델을 다음과 같이 세 가지로 분류한다.

* 사용자 모델: 사용자가 제품에 대해 가지고 있는 개념들의 모습
* 디자인 모델: 설계자가 마음 속에 가지고 있는 시스템에 대한 개념화
* 시스템 이미지: 최종 제품

설계자는 디자인 모델을 기반으로 만든 시스템 이미지가 사용자 모델을 정확하게 반영하도록 노력해야 한다. 또한 도메인 모델은 위 세 가지를 모두 포함한다. 결국 도메인 모델은 소프트웨어에 대한 멘탈 모델이 된다.

### 도메인의 모습을 담을 수 있는 객체지향
&nbsp;최종 코드는 사용자가 도메인을 바라보는 관점을 반영해야 한다. 이는 객체지향을 통해서 해결할 수 있고, 도메인에 대한 사용자 모델, 디자인 모델, 시스템 이미지 모두가 유사한 모습을 유지하도록 만드는 것이 가능하다. 이러한 객체지향의 특징을 `연결완전성` 혹은 `표현적 차이`라고 한다.

### 표현적 차이
&nbsp;소프트웨어 객체는 현실 객체에 대한 추상화가 아니다. 하지만 소프트웨어 객체는 현실 객체를 기반으로 만들어 진다. 이런 의미적 거리를 '표현적 차이'혹은 '의미적 차이'라고 한다. '은유'를 통해서 이 차이를 최대한 줄여야 한다. 하지만 소프트웨어 객체는 현실에 존재하지 않는 것들이 너무 많다. 따라서 우리는 도메인 모델을 은유해 소프트웨어 객체를 창조해야 한다. 이로써 사용자의 멘탈 모델이 그대로 객체로 변할 수 있을 것이다.

### 불안정한 기능을 담는 안정적인 도메인 모델
&nbsp;도메인 모델이 제공하는 구조는 상대적으로 안정적이다. 사용자가 도메인의 '본질적인'측면을 가장 잘 이해하기 때문에 도메인 모델을 이용해 설계를 해야한다. 따라서 유지보수가 쉬워지며 안정적인 구조를 제공할 수 있을 것이다. 또한 사용자에게 제공할 기능을 기술하기 위해 '유스케이스'라는 기법을 사용한다. 

## 불안정한 재료: 기능

### 유스케이스
&nbsp;사용자에게 제공해야 하는 기능의 목록을 기능적 요구사항이라 한다. 이러한 기능적 요구사항을 이용해 상호작용의 흐름을 텍스트로 정리한 것을 '유스케이스라'고 한다. 유스케이스는 사용자의 목표를 중심으로 시스템의 기능적 요구사항을 이야기 형식으로 묶을 수 있다.

### 유스케이스 특성
&nbsp;다음은 유스케이스의 특성이다.

* 유스케이스는 사용자와 시스템 간의 상호작용을 보여주는 '텍스트'다.
* 유스케이스는 여러 시나리오들의 집합이다.
* 유스케이스는 단순한 피처(feature) 목록과 다르다.
* 유스케이스는 사용자 인터페이스와 관련된 세부 정보를 포함하지 말아야 한다.
* 유스케이스는 내부 설계와 관련된 정보를 포함하지 않는다.

### 유스케이스는 설계 기법도, 객체지향 기법도 아니다
&nbsp;유스케이스는 시스템 내부 구조나 메커니즘에 관한 어떤 정보도 제공하지 않고 외부 관점만을 표현한다. 유스케이스는 단지 기능적 요구사항을 사용자의 목표라는 관점에서 나타내기 위한 정리 기법일 뿐이다.

## 재료 합치기: 기능과 구조의 통합

### 도메인 모델, 유스케이스, 그리고 책임-주도 설계
&nbsp;불안정한 기능들을 안정적인 구조 안에 담음으로써 변경에 대한 파급 효과를 줄일 수 있다. 안정적인 구조를 개념화하기 위해서 도메인 모델을 불안정한 기능을 서술하기 위해 유스케이스를 사용했다. 유스케이스에 정의된 시스템 기능을 도메인 모델을 기반으로 만든 객체들의 적절한 책임으로 분배해야 한다. 

책임을 더 작은 규모의 책임으로 세분화하는 과정에서 우리는 도메인 모델에 포함된 개념을 은유하는 객체를 선택에 책임을 분배해야 한다. 이로인해 소프트웨어와 코드 사이의 표현적 차이를 줄일 수 있다. 객체들에게 책임을 할당해 나가고 마지막에 클래스를 이용해 속성과 메서드를 구현하면 기능을 완성할 수 있다.

책임-주도 설계 방법은 유스케이스와 도메인 모델을 하나로 통합시켜 설계를 하지만 꼭 유스케이스와 도메인 모델이 필요한 것은 아니다. 또한 유스케이스와 도메인 모델이 책임-주도 설계에서만 사용되는 것도 아니다.

### 기능 변경을 흡수하는 안정적인 구조
&nbsp;도메인 모델은 다음과 같은 특징을 가지고 있다.

* 도메인 모델을 구성하는 개념은 비즈니스가 없어지거나 완전히 개편되지 않는 한 안정적으로 유지된다.
* 도메인 모델을 구성하는 개념 간의 관계는 비즈니스 규칙을 기반으로 하기 때문에 비즈니스 정책이 크게 변경되지 않는 한 안정적으로 유지된다.

위와 같은 특징 덕분에 도메인 모델은 안정적이다. 이런 안정적인 도메인 모델에 유스케이스의 기능을 객체에게 분배하면 유연함을 잘 보여주는 기본적인 객체지향 설계 방식이다. 기능적 요구사항이 변경될 경우 책임과 객체간의 대응 관계만 수정될 뿐이다.

또한 도메인을 모델링하기 위한 기법과 도메인을 프로그래밍하기 위한 기법이 동일하기 때문에 도메인 모델의 객체와 개념을 프로그래밍 객체로 매끄럽게 변환할 수 있다. 이러한 특성을 '연결완전성'이라고 한다. 또한 연결완전성의 역방향 역시 성립하는 가역성(reversibility)의 특징을 가지고 있기 때문에 코드에서 모델로의 매끄러운 흐름까지 알 수 있다.

안정적인 도메인 모델을 기반으로 시스템 기능을 구현하면 진정한 객체지향 시스템 설계의 첫걸음이 될 것이다.